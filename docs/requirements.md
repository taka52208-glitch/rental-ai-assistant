# 賃貸AIアシスタント - 要件定義書

## 要件定義の作成原則
- **「あったらいいな」は絶対に作らない**
- **拡張可能性のための余分な要素は一切追加しない**
- **将来の「もしかして」のための準備は禁止**
- **今、ここで必要な最小限の要素のみ**

---

## 1. プロジェクト概要

### 1.1 成果目標
賃貸仲介不動産向けAI自動応答デモシステム。LINE風WebチャットUIで「新規問い合わせ→希望条件ヒアリング→物件提案→電話予約確定」をAIが自動対応し、案件獲得のためのデモンストレーションを行う。

### 1.2 成功指標

#### 定量的指標
- 応答速度: 3秒以内に返信開始
- シナリオ完遂: 問い合わせ→電話予約まで全ステップAI完結
- 物件提案: ダミー物件3〜5件から条件に合うものを提案
- 予約確定: 日時・連絡先の取得まで自動化

#### 定性的指標
- 自然な対話: AI感を感じさせない人間味のある応答
- 正確性: 賃貸不動産の専門知識に基づいた誤りのない回答
- デモ品質: 発注者が「これなら任せられる」と感じる完成度
- 将来性: サブスクサービス化を見据えた拡張可能な設計

---

## 2. システム全体像

### 2.1 主要機能一覧
- **AIチャット応答**: 賃貸に関する問い合わせに自動返信
- **希望条件ヒアリング**: エリア・家賃・間取り等を対話で収集
- **物件提案**: 条件に合うダミー物件を提案
- **電話予約確定**: 日時・連絡先を取得し予約完了

### 2.2 ユーザーロールと権限（MVPのため簡略化）
- ゲスト: 全機能にアクセス可能（認証不要）

### 2.3 認証・認可要件
- 認証方式: なし（公開デモ）
- セキュリティレベル: 公開情報のみ扱う
- 管理機能: なし（MVP対象外）

---

## 3. ページ詳細仕様

### 3.1 P-001: ランディングページ

#### 目的
サービス概要を伝え、デモ体験へ誘導する

#### 主要機能
- ヒーローセクション（キャッチコピー + サービス説明）
- 特徴3点の紹介
- 「デモを試す」CTAボタン

#### 必要な操作
| 操作種別 | 操作内容 | 必要な入力 | 期待される出力 |
|---------|---------|-----------|---------------|
| 遷移 | チャット画面へ移動 | ボタンクリック | /chat への遷移 |

#### 処理フロー
1. ユーザーがランディングページにアクセス
2. サービス概要を確認
3. 「デモを試す」ボタンをクリック
4. チャット画面へ遷移

#### データ構造（概念）
```yaml
なし（静的ページ）
```

---

### 3.2 P-002: AIチャット画面

#### 目的
AI自動応答の実力をデモンストレーションし、案件獲得につなげる

#### 主要機能
- LINE風チャットUI
- AIによる自動応答
- タイピングアニメーション
- 会話履歴表示

#### 必要な操作
| 操作種別 | 操作内容 | 必要な入力 | 期待される出力 |
|---------|---------|-----------|---------------|
| 送信 | メッセージ送信 | テキスト入力 | AI応答の表示 |
| 取得 | 会話履歴取得 | なし | 過去メッセージ一覧 |

#### 処理フロー
1. ユーザーがメッセージを入力
2. フロントエンドがバックエンドAPIに送信
3. バックエンドがClaude APIに問い合わせ
4. AI応答を受信
5. タイピングアニメーション付きで表示

#### 対応シナリオ
1. **挨拶・新規問い合わせ受付**: 「こんにちは」「物件を探しています」等
2. **希望条件ヒアリング**: エリア、家賃上限、間取り、入居時期等を順次確認
3. **物件提案**: 条件に合うダミー物件を提案（3〜5件から選定）
4. **電話予約確定**: 希望日時・連絡先を取得
5. **完了メッセージ**: 予約確定の旨を伝える

#### データ構造（概念）
```yaml
Message:
  識別子: messageId（UUID）
  基本情報:
    - role（user / assistant）（必須）
    - content（メッセージ本文）（必須）
  メタ情報:
    - timestamp（送信日時）
  関連:
    - Conversation（1対多）

Conversation:
  識別子: conversationId（UUID）
  基本情報:
    - messages（メッセージ配列）
    - currentStep（シナリオ進行状況）
  メタ情報:
    - createdAt
    - updatedAt

Property（ダミー物件）:
  識別子: propertyId
  基本情報:
    - name（物件名）（必須）
    - area（エリア）（必須）
    - rent（家賃）（必須）
    - layout（間取り）（必須）
    - features（特徴）（任意）
```

---

## 4. データ設計概要

### 4.1 主要エンティティ

```yaml
Message:
  概要: チャットの1メッセージ
  主要属性:
    - role: user または assistant
    - content: メッセージ本文
    - timestamp: 送信日時
  関連:
    - Conversation（多対1）

Conversation:
  概要: 1回のチャットセッション
  主要属性:
    - messages: メッセージ配列
    - currentStep: シナリオ進行状況
    - collectedInfo: 収集済み情報（エリア、家賃等）
  関連:
    - Message（1対多）

Property:
  概要: ダミー物件データ
  主要属性:
    - name: 物件名
    - area: エリア
    - rent: 家賃（万円）
    - layout: 間取り（1K, 2LDK等）
    - station: 最寄駅
    - walkMinutes: 駅徒歩分
    - features: 特徴（配列）
```

### 4.2 エンティティ関係図
```
Conversation ─── Message  （1対多）
     │
     └── collectedInfo（埋め込み）

Property（独立・静的データ）
```

### 4.3 バリデーションルール
```yaml
メッセージ本文:
  - ルール: 1文字以上、2000文字以下
  - 理由: 空送信防止、API制限対応

電話番号（収集時）:
  - ルール: 10〜11桁の数字
  - 理由: 日本の電話番号形式
```

---

## 5. 制約事項

### 外部API制限
- **Claude API**: Rate Limit あり（Tier依存）、従量課金

### 技術的制約
- **応答速度**: Claude Haiku使用で3秒以内を目標
- **同時接続**: デモ用途のため大規模アクセスは想定しない

---

## 5.1 セキュリティ要件

### 基本方針
本プロジェクトは **CVSS 3.1（Common Vulnerability Scoring System）** に準拠したセキュリティ要件を満たすこと。

### MVP判定

**認証機能がない場合（本プロジェクト該当）**:
- ブルートフォース対策は不要
- 基本的なセキュリティヘッダーのみ設定

**その他の一般要件**:
- ✅ HTTPSの強制（本番環境）
- ✅ セキュリティヘッダー設定（本番環境）
- ✅ 入力値のサニタイゼーション
- ✅ エラーメッセージでの情報漏洩防止

---

### 運用要件：可用性とヘルスチェック

**ヘルスチェックエンドポイント（必須）**:
- エンドポイント: `/api/health`
- 目的: Cloud Runでのliveness/readinessプローブ
- 要件: 5秒以内の応答

**グレースフルシャットダウン（必須）**:
- SIGTERMシグナルハンドラーの実装
- タイムアウト: 8秒（Cloud Runの10秒制限に対応）

---

## 6. 複合API処理（バックエンド内部処理）

### 複合処理-001: AIチャット応答生成

**トリガー**: ユーザーがメッセージを送信
**フロントエンドAPI**: POST /api/chat
**バックエンド内部処理**:
1. リクエストからメッセージと会話履歴を取得
2. システムプロンプト（賃貸知識 + シナリオ指示）を構築
3. Claude API（Haiku）に送信
4. 応答を整形して返却
**結果**: AI応答メッセージ
**外部サービス依存**: Anthropic Claude API

---

## 7. 技術スタック

### フロントエンド
| 技術 | バージョン | 用途 |
|------|-----------|------|
| React | 18.x | UIフレームワーク |
| TypeScript | 5.x | 型安全性 |
| @chatscope/chat-ui-kit-react | 最新 | チャットUI |
| MUI | v6 | ランディングページUI |
| Vite | 5.x | ビルドツール |
| React Router | v6 | ルーティング |

### バックエンド
| 技術 | バージョン | 用途 |
|------|-----------|------|
| Python | 3.11+ | サーバー言語 |
| FastAPI | 最新 | APIフレームワーク |
| anthropic | 最新 | Claude API SDK |
| uvicorn | 最新 | ASGIサーバー |

### インフラ
| 技術 | 用途 |
|------|------|
| Vercel | フロントエンドホスティング |
| Google Cloud Run | バックエンドホスティング |

---

## 8. 必要な外部サービス・アカウント

### 必須サービス
| サービス名 | 用途 | 取得先 | 備考 |
|-----------|------|--------|------|
| Anthropic API | AI応答生成 | https://console.anthropic.com/ | 従量課金 |
| Vercel | フロントエンド | https://vercel.com/ | 無料枠あり |
| Google Cloud | バックエンド | https://console.cloud.google.com/ | 無料枠あり |

### オプションサービス
なし

---

## 9. 今後の拡張予定

**原則**: 拡張予定があっても、必要最小限の実装のみを行う

（拡張候補 - 実装はしない）
- 実際のLINE公式アカウント連携
- 管理画面（会話履歴・エスカレーション通知）
- 実物件データベース連携
- マルチテナント対応（サブスクサービス化）
- 分析ダッシュボード

---

## 付録：ダミー物件データ

```json
[
  {
    "propertyId": "P001",
    "name": "グランメゾン新宿",
    "area": "新宿区",
    "rent": 12,
    "layout": "1LDK",
    "station": "新宿駅",
    "walkMinutes": 8,
    "features": ["オートロック", "宅配ボックス", "築5年"]
  },
  {
    "propertyId": "P002",
    "name": "コンフォート渋谷",
    "area": "渋谷区",
    "rent": 15,
    "layout": "2LDK",
    "station": "渋谷駅",
    "walkMinutes": 10,
    "features": ["ペット可", "角部屋", "南向き"]
  },
  {
    "propertyId": "P003",
    "name": "プレシャス池袋",
    "area": "豊島区",
    "rent": 9,
    "layout": "1K",
    "station": "池袋駅",
    "walkMinutes": 5,
    "features": ["駅近", "バス・トイレ別", "収納豊富"]
  },
  {
    "propertyId": "P004",
    "name": "リバーサイド中野",
    "area": "中野区",
    "rent": 8,
    "layout": "1K",
    "station": "中野駅",
    "walkMinutes": 7,
    "features": ["初期費用安め", "インターネット無料", "フローリング"]
  },
  {
    "propertyId": "P005",
    "name": "パークビュー世田谷",
    "area": "世田谷区",
    "rent": 18,
    "layout": "2LDK",
    "station": "三軒茶屋駅",
    "walkMinutes": 6,
    "features": ["ルーフバルコニー", "床暖房", "閑静な住宅街"]
  }
]
```

---

## 付録：AIシステムプロンプト（参考）

```
あなたは賃貸仲介不動産会社「〇〇不動産」のスタッフです。
お客様からのお問い合わせに、親しみやすく丁寧に対応してください。

【対応の流れ】
1. まず挨拶し、どのようなお部屋をお探しか確認
2. 以下の希望条件を順番にヒアリング:
   - ご希望のエリア
   - 家賃の上限
   - 間取り（1K、1LDK、2LDK等）
   - 入居希望時期
3. 条件に合う物件を提案
4. ご興味があれば、お電話でのご相談日時を調整
5. お名前とご連絡先を確認し、予約確定

【注意事項】
- 必ず敬語を使い、親しみやすいトーンで
- 一度に多くの質問をせず、1つずつ確認
- お客様の回答には共感を示す
- 不明点は正直に「確認いたします」と伝える
```
